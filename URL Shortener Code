from flask import Flask, request, redirect, render_template_string
import string
import random

app = Flask(__name__)

# In-memory storage for shortened URLs
url_mapping = {}

def generate_short_url(length=6):
    """Generate a random short URL."""
    characters = string.ascii_letters + string.digits
    return ''.join(random.choice(characters) for _ in range(length))

@app.route('/', methods=['GET', 'POST'])
def home():
    if request.method == 'POST':
        original_url = request.form['url']
        short_url = generate_short_url()
        
        # Ensure the short URL is unique
        while short_url in url_mapping:
            short_url = generate_short_url()
        
        url_mapping[short_url] = original_url
        return render_template_string('''
            <h1>URL Shortener</h1>
            <p>Original URL: {{ original_url }}</p>
            <p>Short URL: <a href="/{{ short_url }}">http://localhost:5000/{{ short_url }}</a></p>
            <a href="/">Shorten another URL</a>
        ''', original_url=original_url, short_url=short_url)

    return render_template_string('''
        <h1>URL Shortener</h1>
        <form method="POST">
            <input type="text" name="url" placeholder="Enter URL to shorten" required>
            <button type="submit">Shorten</button>
        </form>
    ''')

@app.route('/<short_url>')
def redirect_to_url(short_url):
    original_url = url_mapping.get(short_url)
    if original_url:
        return redirect(original_url)
    return "URL not found", 404

if __name__ == '__main__':
    app.run(debug=True)
